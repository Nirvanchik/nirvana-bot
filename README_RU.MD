
# Бот CleanArchiveBot
## Назначение
CleanArchiveBot предназначен для чистки архивов новых статей от ненужных
статей - статей, не относящихся к главной теме данного портала или проекта. Как
правило, это нужно для исправления статистики, удаления из рейтинга случайно
попавших туда авторов.

## Как пользоваться
### Список ненужных статей
Сначала нужно собрать список ненужных статей. Я для этого использую сервис
http://petscan.wmflabs.org/. Указываю язык (language) ru, глубину (depth) - 
высчитываю по формуле:
```
  глубина = глубина корневой категории проекта (обычно 6) - 
            глубина от корневой категории до категории, которую надо
			заигнорировать.
```
К примеру в Биологии у меня было так (вырезали категорию Умершие):
```
  глубина (Умершие) = 7 - 2 = 5.
```
В Categories указываю категории, которые нужно заигнорировать (в которых лежат
статьи не по теме), в Negative categories указываю подкатегории, в которых
встречаются статьи по теме, в Output указывают формат TSV.
В результате, получаю список, который выглядит примерно так:
```
number	title	pageid	namespace	length	touched
1	Кавказские_Минеральные_Воды	30		80443	20180616170834
2	Санкт-Петербург	45		302800	20180616210327
3	Шартр	53		7574	20180616170834
...
```
Но можно собрать список любым другим сервисом (pywikibot, AWB, и др.) в обычный
список в текстовом файле (название каждой статьи должно идти с новой строки).

### Создание файла задачи
Файл задачи - это текстовый файл, в котором описаны основные сведения, по
которым бот будет выполнять задачу. Этот файл внутри себя похож на обычный
INI-файл. Разберём файл задачи на примере Биологии:
```
список плохих статей = bad_pages.txt
архив = Портал:Биология/Новые статьи/Архив/
разделитель = \n
формат = tsv
метод = 3
редиректы = нет
```
* Параметр `список плохих статей` - это имя файла в котором лежит список плохих
  статей. Любые статьи из этого списка, которые попадутся в архивах, будут
  удалены из архивов.
* `архив` - вики-ссылка на архив, а если архивов много (архивы разбиты по
  годам, например), то начало названия архивов, общий для них префикс. По этому
  префиксу бот найдет архивы, и отличит их от неархивов.
* `разделитель` - разделитель строк со статьями в архиве.
* `формат` - это формат файла, в котором дан список плохих статей. Возможны
  значения: tsv, txt.
* `метод` - выбор метода, которым бот будет отыскивать плохие статьи. Здесь
  возможны три значения: 1, 2, 3. Самый быстрый способ - 3.
* `редиректы` - должен ли бот отыскивать статьи, которые были переименованы (в
  архиве вики-ссылка будет указывать на редирект). Возможны значения: да, нет.
  Значение "нет" полезно, если хочется прогнать бота максимально быстро. С
  редиректами бот будет работать долго.

### Запуск бота
Указываем в конфигурации бота "config_clean_archive.xml" файл задачи:
```xml
<entry key="task-file">clean_archive_task.txt</entry>
``` 
Если нужно посмотреть, что сделает бот, но не вносить правки, указываем debug
mode = yes, а если по настоящему запустить, тогда no:
```xml
<entry key="debug-mode">no</entry>
```
Запускаем бота:
```
clean_archive.cmd
```
Смотрим результат в Википедии, или в папке дампов (/out/ru/dump).